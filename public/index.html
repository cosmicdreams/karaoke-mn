<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Karaoke MN</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    #player { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Karaoke MN</h1>
  <div id="player"></div>
  <h2>Next Singers</h2>
  <ol id="next"></ol>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let player;
    async function fetchQueue() {
      const res = await fetch('/queue');
      return res.ok ? res.json() : [];
    }
    async function update() {
      const queue = await fetchQueue();
      if (!queue.length) return;
      if (!player) {
        player = new YT.Player('player', {
          height: '390',
          width: '640',
          videoId: queue[0].videoId
        });
      } else {
        const currentId = player.getVideoData().video_id;
        if (queue[0].videoId !== currentId) {
          player.loadVideoById(queue[0].videoId);
        }
      }
      const list = document.getElementById('next');
      list.innerHTML = '';
      queue.slice(1, 6).forEach(item => {
        const li = document.createElement('li');
        li.textContent = item.singer;
        list.appendChild(li);
      });
    }
    function onYouTubeIframeAPIReady() {
      update();
      setInterval(update, 5000);
    }
  </script>
</body>
</html>
